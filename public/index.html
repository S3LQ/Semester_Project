<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My App</title>
    <link rel="stylesheet" href="./styles/style.css" />
  </head>
  <body>
    <div class="center-box">
      <!-- Logg Inn Section -->
      <div id="loginSection">
        <h2>Logg inn</h2>
        <label for="loginUserNavn">Navn:</label>
        <input type="text" id="loginUserNavn" />
        <label for="loginPassord">Passord:</label>
        <input type="password" id="loginPassord" />
        <button id="loginButton">Logg inn</button>
        <button id="showCreateUserButton">Lag bruker</button>
      </div>

      <!-- Lag Bruker Section -->
      <div id="createUserSection" style="display: none">
        <h2>Lag bruker</h2>
        <label for="navn">Navn:</label>
        <input type="text" id="navn" />
        <label for="email">Email:</label>
        <input type="email" id="email" />
        <label for="pswHash">Passord:</label>
        <input type="password" id="pswHash" />
        <button id="createUserButton">Lag bruker</button>
        <button id="backToLoginButton">Tilbake til Logg inn</button>
      </div>
    </div>

    <script type="module">
      import postToUsers from "./scripts/postToUsers.mjs";
      // Function to toggle between login and create user sections
      document
        .getElementById("showCreateUserButton")
        .addEventListener("click", function () {
          document.getElementById("loginSection").style.display = "none";
          document.getElementById("createUserSection").style.display = "block";
        });

      document;
      const loginButton = document.getElementById("loginButton");
      loginButton.addEventListener("click", async function () {
        document.getElementById("loginSection").style.display = "block";
        document.getElementById("createUserSection").style.display = "none";
      });

      // Get a reference to the Create User button
      const createUserButton = document.getElementById("createUserButton");

      // Add an event listener to the Create User button
      createUserButton.addEventListener("click", async function () {
        // Get values from input fields
        const name = document.getElementById("navn").value;
        const email = document.getElementById("email").value;
        const pswHash = document.getElementById("pswHash").value;
        const authString = email + pswHash;
        const type = "createUser";

        const user = { name, email, authString, type };

        try {
          // Call the createUser function with the input values
          await postToUsers(user)
            .then((res) => {
              if (res.ok) {
                return res.json();
              }
            })
            .then((data) => {
              console.log(data);
              localStorage.setItem("userData", data);
              window.location.href = "recipes.html";
            });
          console.log("User created successfully");
          // Redirect the user to another page or perform any other action
        } catch (error) {
          console.error("Failed to create user:", error.message);
          // Handle error, e.g., display an error message to the user
        }
      });
    </script>
    <script type="module" src="./scripts/loginScript.mjs"></script>
  </body>
</html>
