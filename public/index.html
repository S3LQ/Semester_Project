<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Oppskriftsapp</title>
    <link rel="stylesheet" href="./styles/style.css" />
  </head>
  <body>
    <div class="center-box">
      <div id="loginSection">
        <h2>Logg inn til din bruker for Ã¥ se oppskrifter</h2>
        <label for="loginUserNavn">Email:</label>
        <input type="text" id="loginUserNavn" />
        <label for="loginPassord">Passord:</label>
        <input type="password" id="loginPassord" />
        <button id="loginButton">Logg inn</button>
        <button id="showCreateUserButton">Lag bruker</button>
      </div>

      <div id="createUserSection" style="display: none">
        <h2>Lag bruker</h2>
        <label for="navn">Navn:</label>
        <input type="text" id="navn" />
        <label for="email">Email:</label>
        <input type="email" id="email" />
        <label for="pswHash">Passord:</label>
        <input type="password" id="pswHash" />
        <button id="createUserButton">Lag bruker</button>
        <button id="backToLoginButton">Tilbake til Logg inn</button>
      </div>
    </div>

    <script type="module">
      import postToUsers from "./scripts/postToUsers.mjs";
      document
        .getElementById("showCreateUserButton")
        .addEventListener("click", function () {
          document.getElementById("loginSection").style.display = "none";
          document.getElementById("createUserSection").style.display = "block";
        });

      document;
      const loginButton = document.getElementById("loginButton");
      loginButton.addEventListener("click", async function () {
        document.getElementById("loginSection").style.display = "block";
        document.getElementById("createUserSection").style.display = "none";
      });

      const createUserButton = document.getElementById("createUserButton");

      createUserButton.addEventListener("click", async function () {
        const name = document.getElementById("navn").value;
        const email = document.getElementById("email").value;
        const pswHash = document.getElementById("pswHash").value;
        const authString = email + pswHash;
        const type = "createUser";

        const user = { name, email, authString, type };

        try {
          await postToUsers(user)
            .then((res) => {
              if (res.ok) {
                return res.json();
              }
            })
            .then((data) => {
              localStorage.setItem("userData", data);
              window.location.href = "index.html";
            });
        } catch (error) {
          console.error("Failed to create user:", error.message);
        }
      });

      const backToLoginButton = document.getElementById("backToLoginButton");
      backToLoginButton.addEventListener("click", function () {
        document.getElementById("createUserSection").style.display = "none";
        document.getElementById("loginSection").style.display = "block";
      });
    </script>
    <script type="module" src="./scripts/loginScript.mjs"></script>
  </body>
</html>
